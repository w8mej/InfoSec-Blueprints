title: AWS Metadata Service Credential Theft
status: experimental
author: wssheldo
date: 2020/06/30
description: >
  Detects attempts to query the credential
  metadata service in load balancer logs that
  returned a 200 status code.
references:
  - https://netflixtechblog.com/netflix-information-security-preventing-credential-compromise-in-aws-41b112c15179
logsource:
  source: elb
detection: |-
  index=aws sourcetype="aws:elb:accesslogs" earliest=-1h
  (request="*security-credentials*" AND request="*169.254.169.254*"
  AND request="*meta-data*") elb!=app/tails-splunk-web-production*
  elb=* elb_status_code=200 | table _time, elb, client_ip,
  user_agent, type, target_status_code, elb_status_code, received_bytes, request
severity: 3
page: false
falsepositives:
tags: >
  - attack.t1522
