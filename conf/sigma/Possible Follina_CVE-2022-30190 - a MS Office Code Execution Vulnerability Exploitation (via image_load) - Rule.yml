title: Possible Follina/CVE-2022-30190 - a MS Office Code Execution Vulnerability Exploitation (via image_load)
id: f547d3f8-c56b-42dd-878e-d20dee53c632
status: stable
description: Possible abuse of ms-msdt MSProtocol URI scheme to load and execute malicious code. It is highly recommended to baseline your activity and tune out common business use cases.
author: SOC Prime Team
references:
    - https://twitter.com/Antonlovesdnb/status/1531989797044162563
    - https://uberagent.com/blog/detecting-cve-2022-30190-office-rce-with-uberagent-esa-splunk/
    - https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e
    - https://app.any.run/tasks/713f05d2-fe78-4b9d-a744-f7c133e3fafb/
    - https://twitter.com/nao_sec/status/1530196847679401984
    - https://blog.syss.com/posts/abusing-ms-office-protos/
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-30190
    - https://gist.github.com/Samirbous/9384ee6667f8b472ee6d9dcd505bd175
    - https://research.checkpoint.com/2023/behind-the-scenes-of-bbtok-analyzing-a-bankers-server-side-components/
tags:
    - attack.defense_evasion
    - attack.t1221
logsource:
    category: image_load
    product: windows
detection:
    selection:
        Image|endswith:
            - 'WINWORD.EXE'
            - 'EXCEL.EXE'
            - 'POWERPNT.EXE'
            - 'MSPUB.EXE'
            - 'VISIO.EXE'
            - 'OUTLOOK.EXE'
            - 'MSACCESS.EXE'
            - 'MSPROJECT.EXE'
            - 'ONENOTE.EXE'
        ImageLoaded|endswith:
            - 'PeerDist.dll'
            - 'hlink.dll'
            - 'mshtml.dll'
            - 'ieframe.dll'
            - 'dsparse.dll'
    condition: selection
falsepositives:
    - Unknown
level: low